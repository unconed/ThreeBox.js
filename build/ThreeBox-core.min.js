var \u03c0=Math.PI,\u03c4=2*\u03c0;(function(a){for(var b in a)if(!window[b])throw"Error: ThreeBox requires "+a[b];})({THREE:"Three.js",tQuery:"tQuery.js (bundle)"});window.ThreeBox={};window.threeBox=function(a,b){a&&!(a instanceof Node)&&(b=a,a=null);return tQuery.createWorld(b).threeBox(a,b)};MicroEvent.prototype.on=function(){MicroEvent.prototype.bind.apply(this,arguments);return this};MicroEvent.prototype.emit=function(){MicroEvent.prototype.trigger.apply(this,arguments);return this};
MicroEvent.mixin=function(a){for(var b=["bind","unbind","trigger","on","emit"],c=0;c<b.length;c++)a.prototype[b[c]]=MicroEvent.prototype[b[c]]};tQuery.World.prototype.on=tQuery.World.prototype.addEventListener;tQuery.World.prototype.emit=tQuery.World.prototype.dispatchEvent;
tQuery.World.register("threeBox",function(a,b){a&&!(a instanceof Node)&&(b=a,a=null);var c=a=a||document.body;a==document.body?(c.style.margin=0,c.style.padding=0,c.style.overflow="hidden"):(getComputedStyle(a),"static"==a.position&&(a.position="relative"));this.appendTo(c);this.addThreeBox(a,b||{});return this});
tQuery.World.register("addThreeBox",function(a,b){console.assert(!0!==this.hasThreeBox());b=tQuery.extend(b,{cameraControls:!1,cursor:!0,controlClass:ThreeBox.OrbitControls,elementResize:!0,fullscreen:!0,screenshot:!0,stats:!0,scale:1});this.tRenderer().domElement.style.display="block";var c={};tQuery.data(this,"_threeBoxContext",c);var d=this.tCamera(),e=this.tRenderer();b.stats&&(c.stats=new Stats,c.stats.domElement.style.position="absolute",c.stats.domElement.style.left="10px",c.stats.domElement.style.top=
"10px",a&&a.appendChild(c.stats.domElement),c.loopStats=function(){c.stats.update()},this.loop().hook(c.loopStats));if(b.cameraControls){var g=this.loop(),f=this.render.bind(this);c.cameraControls=ThreeBox.OrbitControls.bind(d,a,b).on("change",function(){g._timerId||f()});this.setCameraControls(c.cameraControls)}b.elementResize&&(c.elementResize=ThreeBox.ElementResize.bind(e,d,a,b.scale).on("resize",function(a,b){this._opts.renderW=a;this._opts.renderH=b;this.emit("resize",a,b)}.bind(this)));null!==
b.cursor&&(c.cursor=ThreeBox.Cursor.bind(a,b));b.screenshot&&(c.screenshot=THREEx.Screenshot.bindKey(e));b.fullscreen&&THREEx.FullScreen.available()&&(c.fullscreen=THREEx.FullScreen.bindKey());c._$onDestroy=this.bind("destroy",function(){!1!==this.hasThreeBox()&&this.removeThreeBox()});return this});tQuery.World.register("hasThreeBox",function(){return void 0===tQuery.data(this,"_threeBoxContext")?!1:!0});
tQuery.World.register("removeThreeBox",function(){var a=tQuery.data(this,"_threeBoxContext");if(void 0===a)return this;tQuery.removeData(this,"_threeBoxContext");this.unbind("destroy",this._$onDestroy);a.stats&&(document.body.removeChild(a.stats.domElement),this.loop().unhook(a.loopStats));a.cameraControls&&this.removeCameraControls()&&a.cameraControls.stop();a.elementResize&&a.elementResize.unbind();a.cursor&&a.cursor.unbind();a.screenshot&&a.screenshot.unbind();a.fullscreen&&a.fullscreen.unbind()});
ThreeBox.ElementResize=function(a,b,c,d){this.scale=d||1;d=this.callback=function(){var e=Math.floor(c.offsetWidth),d=Math.floor(c.offsetHeight);a.domElement.style.position="absolute";a.domElement.style.width=e+"px";a.domElement.style.height=d+"px";var f=Math.floor(e/this.scale),h=Math.floor(d/this.scale);a.setSize(f,h);b.aspect=e/d;b.updateProjectionMatrix();this.emit("resize",f,h)}.bind(this);window.addEventListener("resize",d,!1);c.addEventListener("resize",d,!1);setTimeout(d,0)};
ThreeBox.ElementResize.bind=function(a,b,c,d){return new ThreeBox.ElementResize(a,b,c,d)};ThreeBox.ElementResize.prototype.scale=function(a){this.scale=a};ThreeBox.ElementResize.prototype.unbind=function(){window.removeEventListener("resize",callback);domElement.removeEventListener("resize",callback)};MicroEvent.mixin(ThreeBox.ElementResize);
ThreeBox.OrbitControls=function(a,b,c){this.element=b;this.camera=a;this.options=tQuery.extend(c,{phi:\u03c4/4,theta:0.3,orbit:2,lookAt:[0,0,0],speed:2});this.init();this.start();this.update()};
ThreeBox.OrbitControls.prototype={init:function(){this.width=this.element.offsetWidth;this.height=this.element.offsetHeight;this.phi=this.options.phi;this.theta=this.options.theta;this.orbit=this.options.orbit;this.speed=this.options.speed;this.lookAt=new THREE.Vector3;this.lookAt.set.apply(this.lookAt,this.options.lookAt||[])},start:function(){var a=this;this._mouseDown=function(a){this.drag=!0;this.lastHover=this.origin={x:a.pageX,y:a.pageY};a.preventDefault()}.bind(this);this._mouseUp=function(){this.drag=
!1}.bind(this);this._mouseMove=function(){if(a.drag){var b={x:event.pageX-a.origin.x,y:event.pageY-a.origin.y},c={x:event.pageX-a.lastHover.x,y:event.pageY-a.lastHover.y};a.lastHover={x:event.pageX,y:event.pageY};a.moved(a.origin,b,c)}}.bind(this);this.element.addEventListener("mousedown",this._mouseDown,!1);document.addEventListener("mouseup",this._mouseUp,!1);document.addEventListener("mousemove",this._mouseMove,!1)},stop:function(){this.element.removeEventListener("mousedown",this._mouseDown);
document.removeEventListener("mouseup",this._mouseUp);document.removeEventListener("mousemove",this._mouseMove)},moved:function(a,b,c){this.phi+=c.x*this.speed/this.width;this.theta=Math.min(\u03c0/2,Math.max(-\u03c0/2,this.theta+c.y*this.speed/this.height));this.emit("change")},update:function(){this.camera.position.x=Math.cos(this.phi)*Math.cos(this.theta)*this.orbit;this.camera.position.y=Math.sin(this.theta)*this.orbit;this.camera.position.z=Math.sin(this.phi)*Math.cos(this.theta)*this.orbit;
this.camera.position.addSelf(this.lookAt);this.camera.lookAt(this.lookAt)}};ThreeBox.OrbitControls.bind=function(a,b,c){return new ThreeBox.OrbitControls(a,b,c)};MicroEvent.mixin(ThreeBox.OrbitControls);
ThreeBox.Cursor=function(a,b){function c(){g||(a.style.cursor=d);clearTimeout(e);g=!1;e=setTimeout(function(){g=!0;a.style.cursor="none"},f)}var d=b.cameraControls?"move":"default",e=null,g=!1,f=2E3;b.cursor?a.style.cursor=d:(a.addEventListener("mousemove",c),a.style.cursor="none");return{unbind:function(){a.removeEventListener("mousemove",c)}}};ThreeBox.Cursor.bind=function(a,b){return ThreeBox.Cursor(a,b)};
ThreeBox.preload=function(a,b){a instanceof Function&&(b=a,a=[]);var a="string"==typeof a?[a]:a,c=a.length;_.each(a,function(a){new microAjax(a,function(a){var d;(d=a.match(/^<script[^>]*type=['"]text\/javascript['"][^>]*>([\s\S]+?)<\/script>$/m))?(a=document.createElement("script"),a.type="text/javascript",a.innerHTML=d[1],document.body.appendChild(a)):(d=document.createElement("div"),d.innerHTML=a,document.body.appendChild(d));0==--c&&b()})})};
