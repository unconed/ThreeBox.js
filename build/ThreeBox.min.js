var MicroEvent=function(){};MicroEvent.prototype={bind:function(b,d){this._events=this._events||{};this._events[b]=this._events[b]||[];this._events[b].push(d)},unbind:function(b,d){this._events=this._events||{};!1!==b in this._events&&this._events[b].splice(this._events[b].indexOf(d),1)},trigger:function(b){this._events=this._events||{};if(!1!==b in this._events)for(var d=0;d<this._events[b].length;d++)this._events[b][d].apply(this,Array.prototype.slice.call(arguments,1))}};
MicroEvent.mixin=function(b){for(var d=["bind","unbind","trigger"],e=0;e<d.length;e++)b.prototype[d[e]]=MicroEvent.prototype[d[e]]};"undefined"!==typeof module&&"exports"in module&&(module.exports=MicroEvent);
function microAjax(b,d,e){this.bindFunction=function(b,d){return function(){return b.apply(d,[d])}};this.stateChange=function(b){4==this.request.readyState&&this.callbackFunction(this.request.responseText)};this.getRequest=function(){return window.ActiveXObject?new ActiveXObject("Microsoft.XMLHTTP"):window.XMLHttpRequest?new XMLHttpRequest:!1};this.postBody=e||"";this.callbackFunction=d;this.url=b;if(this.request=this.getRequest())d=this.request,d.onreadystatechange=this.bindFunction(this.stateChange,
this),""!==this.postBody?(d.open("POST",b,!0),d.setRequestHeader("X-Requested-With","XMLHttpRequest"),d.setRequestHeader("Content-type","application/x-www-form-urlencoded"),d.setRequestHeader("Connection","close")):d.open("GET",b,!0),d.send(this.postBody)}
(function(){function b(a,f,l){if(a===f)return 0!==a||1/a==1/f;if(null==a||null==f)return a===f;a._chain&&(a=a._wrapped);f._chain&&(f=f._wrapped);if(a.isEqual&&c.isFunction(a.isEqual))return a.isEqual(f);if(f.isEqual&&c.isFunction(f.isEqual))return f.isEqual(a);var w=p.call(a);if(w!=p.call(f))return!1;switch(w){case "[object String]":return a==""+f;case "[object Number]":return a!=+a?f!=+f:0==a?1/a==1/f:a==+f;case "[object Date]":case "[object Boolean]":return+a==+f;case "[object RegExp]":return a.source==
f.source&&a.global==f.global&&a.multiline==f.multiline&&a.ignoreCase==f.ignoreCase}if("object"!=typeof a||"object"!=typeof f)return!1;for(var d=l.length;d--;)if(l[d]==a)return!0;l.push(a);var d=0,t=!0;if("[object Array]"==w){if(d=a.length,t=d==f.length)for(;d--&&(t=d in a==d in f&&b(a[d],f[d],l)););}else{if("constructor"in a!="constructor"in f||a.constructor!=f.constructor)return!1;for(var e in a)if(c.has(a,e)&&(d++,!(t=c.has(f,e)&&b(a[e],f[e],l))))break;if(t){for(e in f)if(c.has(f,e)&&!d--)break;
t=!d}}l.pop();return t}var d=this,e=d._,h={},g=Array.prototype,m=Object.prototype,k=g.slice,q=g.unshift,p=m.toString,M=m.hasOwnProperty,C=g.forEach,D=g.map,E=g.reduce,F=g.reduceRight,G=g.filter,H=g.every,I=g.some,v=g.indexOf,J=g.lastIndexOf,m=Array.isArray,N=Object.keys,x=Function.prototype.bind,c=function(a){return new r(a)};"undefined"!==typeof exports?("undefined"!==typeof module&&module.exports&&(exports=module.exports=c),exports._=c):d._=c;c.VERSION="1.3.3";var n=c.each=c.forEach=function(a,
f,l){if(null!=a)if(C&&a.forEach===C)a.forEach(f,l);else if(a.length===+a.length)for(var b=0,d=a.length;b<d&&!(b in a&&f.call(l,a[b],b,a)===h);b++);else for(b in a)if(c.has(a,b)&&f.call(l,a[b],b,a)===h)break};c.map=c.collect=function(a,f,c){var b=[];if(null==a)return b;if(D&&a.map===D)return a.map(f,c);n(a,function(a,d,e){b[b.length]=f.call(c,a,d,e)});a.length===+a.length&&(b.length=a.length);return b};c.reduce=c.foldl=c.inject=function(a,f,l,b){var d=2<arguments.length;null==a&&(a=[]);if(E&&a.reduce===
E)return b&&(f=c.bind(f,b)),d?a.reduce(f,l):a.reduce(f);n(a,function(a,c,e){d?l=f.call(b,l,a,c,e):(l=a,d=!0)});if(!d)throw new TypeError("Reduce of empty array with no initial value");return l};c.reduceRight=c.foldr=function(a,f,l,b){var d=2<arguments.length;null==a&&(a=[]);if(F&&a.reduceRight===F)return b&&(f=c.bind(f,b)),d?a.reduceRight(f,l):a.reduceRight(f);var e=c.toArray(a).reverse();b&&!d&&(f=c.bind(f,b));return d?c.reduce(e,f,l,b):c.reduce(e,f)};c.find=c.detect=function(a,f,c){var b;K(a,function(a,
d,e){if(f.call(c,a,d,e))return b=a,!0});return b};c.filter=c.select=function(a,f,c){var b=[];if(null==a)return b;if(G&&a.filter===G)return a.filter(f,c);n(a,function(a,d,e){f.call(c,a,d,e)&&(b[b.length]=a)});return b};c.reject=function(a,f,c){var b=[];if(null==a)return b;n(a,function(a,d,e){f.call(c,a,d,e)||(b[b.length]=a)});return b};c.every=c.all=function(a,f,c){var b=!0;if(null==a)return b;if(H&&a.every===H)return a.every(f,c);n(a,function(a,d,e){if(!(b=b&&f.call(c,a,d,e)))return h});return!!b};
var K=c.some=c.any=function(a,f,b){f||(f=c.identity);var d=!1;if(null==a)return d;if(I&&a.some===I)return a.some(f,b);n(a,function(a,c,e){if(d||(d=f.call(b,a,c,e)))return h});return!!d};c.include=c.contains=function(a,f){var c=!1;return null==a?c:v&&a.indexOf===v?-1!=a.indexOf(f):c=K(a,function(a){return a===f})};c.invoke=function(a,f){var b=k.call(arguments,2);return c.map(a,function(a){return(c.isFunction(f)?f||a:a[f]).apply(a,b)})};c.pluck=function(a,f){return c.map(a,function(a){return a[f]})};
c.max=function(a,f,b){if(!f&&c.isArray(a)&&a[0]===+a[0])return Math.max.apply(Math,a);if(!f&&c.isEmpty(a))return-Infinity;var d={computed:-Infinity};n(a,function(a,c,e){c=f?f.call(b,a,c,e):a;c>=d.computed&&(d={value:a,computed:c})});return d.value};c.min=function(a,f,b){if(!f&&c.isArray(a)&&a[0]===+a[0])return Math.min.apply(Math,a);if(!f&&c.isEmpty(a))return Infinity;var d={computed:Infinity};n(a,function(a,c,e){c=f?f.call(b,a,c,e):a;c<d.computed&&(d={value:a,computed:c})});return d.value};c.shuffle=
function(a){var c=[],b;n(a,function(a,d){b=Math.floor(Math.random()*(d+1));c[d]=c[b];c[b]=a});return c};c.sortBy=function(a,f,b){var d=c.isFunction(f)?f:function(a){return a[f]};return c.pluck(c.map(a,function(a,c,f){return{value:a,criteria:d.call(b,a,c,f)}}).sort(function(a,c){var f=a.criteria,b=c.criteria;return void 0===f?1:void 0===b?-1:f<b?-1:f>b?1:0}),"value")};c.groupBy=function(a,f){var b={},d=c.isFunction(f)?f:function(a){return a[f]};n(a,function(a,c){var f=d(a,c);(b[f]||(b[f]=[])).push(a)});
return b};c.sortedIndex=function(a,f,b){b||(b=c.identity);for(var d=0,e=a.length;d<e;){var g=d+e>>1;b(a[g])<b(f)?d=g+1:e=g}return d};c.toArray=function(a){return a?c.isArray(a)||c.isArguments(a)?k.call(a):a.toArray&&c.isFunction(a.toArray)?a.toArray():c.values(a):[]};c.size=function(a){return c.isArray(a)?a.length:c.keys(a).length};c.first=c.head=c.take=function(a,c,b){return null==c||b?a[0]:k.call(a,0,c)};c.initial=function(a,c,b){return k.call(a,0,a.length-(null==c||b?1:c))};c.last=function(a,c,
b){return null==c||b?a[a.length-1]:k.call(a,Math.max(a.length-c,0))};c.rest=c.tail=function(a,c,b){return k.call(a,null==c||b?1:c)};c.compact=function(a){return c.filter(a,function(a){return!!a})};c.flatten=function(a,b){return c.reduce(a,function(a,d){if(c.isArray(d))return a.concat(b?d:c.flatten(d));a[a.length]=d;return a},[])};c.without=function(a){return c.difference(a,k.call(arguments,1))};c.uniq=c.unique=function(a,b,d){d=d?c.map(a,d):a;var e=[];3>a.length&&(b=!0);c.reduce(d,function(d,l,g){(b?
c.last(d)===l&&d.length:c.include(d,l))||(d.push(l),e.push(a[g]));return d},[]);return e};c.union=function(){return c.uniq(c.flatten(arguments,!0))};c.intersection=c.intersect=function(a){var b=k.call(arguments,1);return c.filter(c.uniq(a),function(a){return c.every(b,function(b){return 0<=c.indexOf(b,a)})})};c.difference=function(a){var b=c.flatten(k.call(arguments,1),!0);return c.filter(a,function(a){return!c.include(b,a)})};c.zip=function(){for(var a=k.call(arguments),b=c.max(c.pluck(a,"length")),
d=Array(b),e=0;e<b;e++)d[e]=c.pluck(a,""+e);return d};c.indexOf=function(a,b,d){if(null==a)return-1;var e;if(d)return d=c.sortedIndex(a,b),a[d]===b?d:-1;if(v&&a.indexOf===v)return a.indexOf(b);d=0;for(e=a.length;d<e;d++)if(d in a&&a[d]===b)return d;return-1};c.lastIndexOf=function(a,b){if(null==a)return-1;if(J&&a.lastIndexOf===J)return a.lastIndexOf(b);for(var c=a.length;c--;)if(c in a&&a[c]===b)return c;return-1};c.range=function(a,b,c){1>=arguments.length&&(b=a||0,a=0);c=arguments[2]||1;for(var d=
Math.max(Math.ceil((b-a)/c),0),e=0,g=Array(d);e<d;)g[e++]=a,a+=c;return g};var L=function(){};c.bind=function(a,b){var d,e;if(a.bind===x&&x)return x.apply(a,k.call(arguments,1));if(!c.isFunction(a))throw new TypeError;e=k.call(arguments,2);return d=function(){if(!(this instanceof d))return a.apply(b,e.concat(k.call(arguments)));L.prototype=a.prototype;var c=new L,g=a.apply(c,e.concat(k.call(arguments)));return Object(g)===g?g:c}};c.bindAll=function(a){var b=k.call(arguments,1);0==b.length&&(b=c.functions(a));
n(b,function(b){a[b]=c.bind(a[b],a)});return a};c.memoize=function(a,b){var d={};b||(b=c.identity);return function(){var e=b.apply(this,arguments);return c.has(d,e)?d[e]:d[e]=a.apply(this,arguments)}};c.delay=function(a,b){var c=k.call(arguments,2);return setTimeout(function(){return a.apply(null,c)},b)};c.defer=function(a){return c.delay.apply(c,[a,1].concat(k.call(arguments,1)))};c.throttle=function(a,b){var d,e,g,h,k,m,p=c.debounce(function(){k=h=!1},b);return function(){d=this;e=arguments;g||
(g=setTimeout(function(){g=null;k&&a.apply(d,e);p()},b));h?k=!0:m=a.apply(d,e);p();h=!0;return m}};c.debounce=function(a,b,c){var d;return function(){var e=this,g=arguments;c&&!d&&a.apply(e,g);clearTimeout(d);d=setTimeout(function(){d=null;c||a.apply(e,g)},b)}};c.once=function(a){var b=!1,c;return function(){if(b)return c;b=!0;return c=a.apply(this,arguments)}};c.wrap=function(a,b){return function(){var c=[a].concat(k.call(arguments,0));return b.apply(this,c)}};c.compose=function(){var a=arguments;
return function(){for(var b=arguments,c=a.length-1;0<=c;c--)b=[a[c].apply(this,b)];return b[0]}};c.after=function(a,b){return 0>=a?b():function(){if(1>--a)return b.apply(this,arguments)}};c.keys=N||function(a){if(a!==Object(a))throw new TypeError("Invalid object");var b=[],d;for(d in a)c.has(a,d)&&(b[b.length]=d);return b};c.values=function(a){return c.map(a,c.identity)};c.functions=c.methods=function(a){var b=[],d;for(d in a)c.isFunction(a[d])&&b.push(d);return b.sort()};c.extend=function(a){n(k.call(arguments,
1),function(b){for(var c in b)a[c]=b[c]});return a};c.pick=function(a){var b={};n(c.flatten(k.call(arguments,1)),function(c){c in a&&(b[c]=a[c])});return b};c.defaults=function(a){n(k.call(arguments,1),function(b){for(var c in b)null==a[c]&&(a[c]=b[c])});return a};c.clone=function(a){return c.isObject(a)?c.isArray(a)?a.slice():c.extend({},a):a};c.tap=function(a,b){b(a);return a};c.isEqual=function(a,c){return b(a,c,[])};c.isEmpty=function(a){if(null==a)return!0;if(c.isArray(a)||c.isString(a))return 0===
a.length;for(var b in a)if(c.has(a,b))return!1;return!0};c.isElement=function(a){return!(!a||1!=a.nodeType)};c.isArray=m||function(a){return"[object Array]"==p.call(a)};c.isObject=function(a){return a===Object(a)};c.isArguments=function(a){return"[object Arguments]"==p.call(a)};c.isArguments(arguments)||(c.isArguments=function(a){return!(!a||!c.has(a,"callee"))});c.isFunction=function(a){return"[object Function]"==p.call(a)};c.isString=function(a){return"[object String]"==p.call(a)};c.isNumber=function(a){return"[object Number]"==
p.call(a)};c.isFinite=function(a){return c.isNumber(a)&&isFinite(a)};c.isNaN=function(a){return a!==a};c.isBoolean=function(a){return!0===a||!1===a||"[object Boolean]"==p.call(a)};c.isDate=function(a){return"[object Date]"==p.call(a)};c.isRegExp=function(a){return"[object RegExp]"==p.call(a)};c.isNull=function(a){return null===a};c.isUndefined=function(a){return void 0===a};c.has=function(a,b){return M.call(a,b)};c.noConflict=function(){d._=e;return this};c.identity=function(a){return a};c.times=
function(a,b,c){for(var d=0;d<a;d++)b.call(c,d)};c.escape=function(a){return(""+a).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;")};c.result=function(a,b){if(null==a)return null;var d=a[b];return c.isFunction(d)?d.call(a):d};c.mixin=function(a){n(c.functions(a),function(b){O(b,c[b]=a[b])})};var P=0;c.uniqueId=function(a){var b=P++;return a?a+b:b};c.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,
escape:/<%-([\s\S]+?)%>/g};var y=/.^/,u={"\\":"\\","'":"'",r:"\r",n:"\n",t:"\t",u2028:"\u2028",u2029:"\u2029"},z;for(z in u)u[u[z]]=z;var Q=/\\|'|\r|\n|\t|\u2028|\u2029/g,R=/\\(\\|'|r|n|t|u2028|u2029)/g,A=function(a){return a.replace(R,function(a,b){return u[b]})};c.template=function(a,b,d){d=c.defaults(d||{},c.templateSettings);a="__p+='"+a.replace(Q,function(a){return"\\"+u[a]}).replace(d.escape||y,function(a,b){return"'+\n_.escape("+A(b)+")+\n'"}).replace(d.interpolate||y,function(a,b){return"'+\n("+
A(b)+")+\n'"}).replace(d.evaluate||y,function(a,b){return"';\n"+A(b)+"\n;__p+='"})+"';\n";d.variable||(a="with(obj||{}){\n"+a+"}\n");a="var __p='';var print=function(){__p+=Array.prototype.join.call(arguments, '')};\n"+a+"return __p;\n";var e=new Function(d.variable||"obj","_",a);if(b)return e(b,c);b=function(a){return e.call(this,a,c)};b.source="function("+(d.variable||"obj")+"){\n"+a+"}";return b};c.chain=function(a){return c(a).chain()};var r=function(a){this._wrapped=a};c.prototype=r.prototype;
var B=function(a,b){return b?c(a).chain():a},O=function(a,b){r.prototype[a]=function(){var a=k.call(arguments);q.call(a,this._wrapped);return B(b.apply(c,a),this._chain)}};c.mixin(c);n("pop push reverse shift sort splice unshift".split(" "),function(a){var b=g[a];r.prototype[a]=function(){var c=this._wrapped;b.apply(c,arguments);var d=c.length;"shift"!=a&&"splice"!=a||0!==d||delete c[0];return B(c,this._chain)}});n(["concat","join","slice"],function(a){var b=g[a];r.prototype[a]=function(){return B(b.apply(this._wrapped,
arguments),this._chain)}});r.prototype.chain=function(){this._chain=!0;return this};r.prototype.value=function(){return this._wrapped}}).call(this);var \u03c0=Math.PI,\u03c4=2*\u03c0;(function(b){for(var d in b)if(!window[d])throw"Error: ThreeBox requires "+b[d];})({THREE:"Three.js",tQuery:"tQuery.js (bundle)"});window.ThreeBox={};window.threeBox=function(b,d){!b||b instanceof Node||(d=b,b=null);return tQuery.createWorld(d).threeBox(b,d)};
MicroEvent.prototype.on=function(){MicroEvent.prototype.bind.apply(this,arguments);return this};MicroEvent.prototype.emit=function(){MicroEvent.prototype.trigger.apply(this,arguments);return this};MicroEvent.mixin=function(b){for(var d=["bind","unbind","trigger","on","emit"],e=0;e<d.length;e++)b.prototype[d[e]]=MicroEvent.prototype[d[e]]};tQuery.World.prototype.on=tQuery.World.prototype.addEventListener;tQuery.World.prototype.emit=tQuery.World.prototype.dispatchEvent;
tQuery.World.registerInstance("threeBox",function(b,d){!b||b instanceof Node||(d=b,b=null);var e=b=b||document.body;b==document.body?(e.style.margin=0,e.style.padding=0,e.style.overflow="hidden"):(getComputedStyle(b),"static"==b.position&&(b.position="relative"));this.appendTo(e);this.addThreeBox(b,d||{});return this});
tQuery.World.registerInstance("addThreeBox",function(b,d){console.assert(!0!==this.hasThreeBox());d=tQuery.extend(d,{cameraControls:!1,cursor:!0,controlClass:ThreeBox.OrbitControls,elementResize:!0,fullscreen:!0,screenshot:!0,stats:!0,scale:1});this.tRenderer().domElement.style.display="block";var e={};tQuery.data(this,"_threeBoxContext",e);var h=this.tCamera(),g=this.tRenderer();d.stats&&(e.stats=new Stats,e.stats.domElement.style.position="absolute",e.stats.domElement.style.left="10px",e.stats.domElement.style.top=
"10px",b&&b.appendChild(e.stats.domElement),e.loopStats=function(){e.stats.update()},this.loop().hook(e.loopStats));if(d.cameraControls){var m=this.loop(),k=this.render.bind(this);e.cameraControls=new d.controlClass(h,b,d);if(e.cameraControls.on)e.cameraControls.on("change",function(){m._timerId||k()});this.setCameraControls(e.cameraControls)}d.elementResize&&(e.elementResize=ThreeBox.ElementResize.bind(g,h,b,d).on("resize",function(b,d){this._opts.renderW=b;this._opts.renderH=d;this.emit("resize",
b,d)}.bind(this)));null!==d.cursor&&(e.cursor=ThreeBox.Cursor.bind(b,d));THREEx&&THREEx.Screenshot&&d.screenshot&&(e.screenshot=THREEx.Screenshot.bindKey(g));THREEx&&THREEx.FullScreen&&d.fullscreen&&THREEx.FullScreen.available()&&(e.fullscreen=THREEx.FullScreen.bindKey());e._$onDestroy=this.bind("destroy",function(){!1!==this.hasThreeBox()&&this.removeThreeBox()});return this});tQuery.World.registerInstance("hasThreeBox",function(){return void 0===tQuery.data(this,"_threeBoxContext")?!1:!0});
tQuery.World.registerInstance("removeThreeBox",function(){var b=tQuery.data(this,"_threeBoxContext");if(void 0===b)return this;tQuery.removeData(this,"_threeBoxContext");this.unbind("destroy",this._$onDestroy);b.stats&&(document.body.removeChild(b.stats.domElement),this.loop().unhook(b.loopStats));b.cameraControls&&this.removeCameraControls()&&b.cameraControls.stop();b.elementResize&&b.elementResize.unbind();b.cursor&&b.cursor.unbind();b.screenshot&&b.screenshot.unbind();b.fullscreen&&b.fullscreen.unbind()});
ThreeBox.ElementResize=function(b,d,e,h){this.scale=h.scale||1;h=this.callback=function(){var g=Math.floor(e.offsetWidth),h=Math.floor(e.offsetHeight);b.domElement.style.position="absolute";b.domElement.style.width=g+"px";b.domElement.style.height=h+"px";var k=Math.floor(g/this.scale),q=Math.floor(h/this.scale);b.setSize(k,q);d.aspect=g/h;d instanceof THREE.OrthographicCamera&&(g=(d.top-d.bottom)/2,h=(d.left+d.right)/2,d.left=h-g*d.aspect,d.right=h+g*d.aspect);d.updateProjectionMatrix();this.emit("resize",
k,q)}.bind(this);window.addEventListener("resize",h,!1);e.addEventListener("resize",h,!1);setTimeout(h,0)};ThreeBox.ElementResize.bind=function(b,d,e,h){return new ThreeBox.ElementResize(b,d,e,h)};ThreeBox.ElementResize.prototype.scale=function(b){this.scale=b};ThreeBox.ElementResize.prototype.unbind=function(){window.removeEventListener("resize",callback);domElement.removeEventListener("resize",callback)};MicroEvent.mixin(ThreeBox.ElementResize);
ThreeBox.OrbitControls=function(b,d,e){this.element=d;this.camera=b;this.options=tQuery.extend(e,{phi:\u03c4/4,theta:.3,orbit:2,lookAt:[0,0,0],speed:2});this.init();this.start();this.update()};
ThreeBox.OrbitControls.prototype={init:function(){this.width=this.element&&this.element.offsetWidth;this.height=this.element&&this.element.offsetHeight;this.phi=this.options.phi;this.theta=this.options.theta;this.orbit=this.options.orbit;this.speed=this.options.speed;this.lookAt=new THREE.Vector3;this.lookAt.set.apply(this.lookAt,this.options.lookAt||[])},start:function(){var b=this;this._mouseDown=function(d){b.width=b.element&&b.element.offsetWidth;b.height=b.element&&b.element.offsetHeight;b.drag=
!0;b.lastHover=b.origin={x:d.pageX,y:d.pageY};d.preventDefault()};this._mouseUp=function(){b.drag=!1};this._mouseMove=function(d){if(b.drag){var e={x:d.pageX-b.origin.x,y:d.pageY-b.origin.y},h={x:d.pageX-b.lastHover.x,y:d.pageY-b.lastHover.y};b.lastHover={x:d.pageX,y:d.pageY};b.moved(b.origin,e,h)}};this._touchstart=function(d){b.width=b.element&&b.element.offsetWidth;b.height=b.element&&b.element.offsetHeight;b.drag=!0;b.lastHover=b.origin={x:d.touches[0].pageX,y:d.touches[0].pageY};d.preventDefault()};
this._touchmove=function(d){if(b.drag){var e={x:d.touches[0].pageX-b.origin.x,y:d.touches[0].pageY-b.origin.y},h={x:d.touches[0].pageX-b.lastHover.x,y:d.touches[0].pageY-b.lastHover.y};b.lastHover={x:d.touches[0].pageX,y:d.touches[0].pageY};b.moved(b.origin,e,h)}d.preventDefault();d.stopPropagation()};this._touchend=function(){b.drag=!1};this.element&&(this.element.addEventListener("mousedown",this._mouseDown,!1),document.addEventListener("mouseup",this._mouseUp,!1),document.addEventListener("mousemove",
this._mouseMove,!1),this.element.addEventListener("touchstart",this._touchstart,!1),this.element.addEventListener("touchend",this._touchend,!1),this.element.addEventListener("touchmove",this._touchmove,!1))},stop:function(){this.element&&(this.element.removeEventListener("mousedown",this._mouseDown),document.removeEventListener("mouseup",this._mouseUp),document.removeEventListener("mousemove",this._mouseMove),this.element.removeEventListener("touchstart",this._touchstart),this.element.removeEventListener("touchend",
this._touchend),this.element.removeEventListener("touchmove",this._touchmove))},moved:function(b,d,e){this.phi+=e.x*this.speed/this.width;this.theta=Math.min(\u03c0/2,Math.max(-\u03c0/2,this.theta+e.y*this.speed/this.height));this.emit("change")},update:function(){this.camera.position.x=Math.cos(this.phi)*Math.cos(this.theta)*this.orbit;this.camera.position.y=Math.sin(this.theta)*this.orbit;this.camera.position.z=Math.sin(this.phi)*Math.cos(this.theta)*this.orbit;this.camera.position.addSelf?this.camera.position.addSelf(this.lookAt):
this.camera.position.add(this.lookAt);this.camera.lookAt(this.lookAt)}};ThreeBox.OrbitControls.bind=function(b,d,e){return new ThreeBox.OrbitControls(b,d,e)};MicroEvent.mixin(ThreeBox.OrbitControls);
ThreeBox.Cursor=function(b,d){function e(){m||(b.style.cursor=h);clearTimeout(g);m=!1;g=setTimeout(function(){m=!0;b.style.cursor="none"},2E3)}var h=d.cameraControls?"move":"default",g=null,m=!1;d.cursor?b.style.cursor=h:(b.addEventListener("mousemove",e),b.style.cursor="none");return{unbind:function(){b.removeEventListener("mousemove",e)}}};ThreeBox.Cursor.bind=function(b,d){return ThreeBox.Cursor(b,d)};
ThreeBox.preload=function(b,d){b instanceof Function&&(d=b,b=[]);b="string"==typeof b?[b]:b;var e=b.length,h={},g=function(b){_.extend(h,b||{});0==--e&&d(h)},m=ThreeBox.preload,k={},q={html:m.html,jpg:m.image,png:m.image,gif:m.image,mp3:m.audio};_.each(q,function(b,d){k[d]=new RegExp("\\."+d+"$")});_.each(b,function(b){_.each(q,function(d,e){if(b.match(k[e])){var h=b.split(/\//g).pop().replace(/\.[A-Za-z0-9]+$/,"");d(b,h,g)}})})};
ThreeBox.preload.html=function(b,d,e){new microAjax(b,function(d){for(var g;g=d.match(/^(<script\s*>|<script[^>]*type=['"]text\/javascript['"][^>]*>)([\s\S]+?)<\/script>$/m);){try{eval("(function () {"+g[2]+"})()")}catch(m){console.error(m),console.error("While evaluating: "+g[2])}d=d.replace(g[0],"")}""!=d.replace(/\s*/g)&&(g=document.createElement("div"),g.innerHTML=d,document.body.appendChild(g));console.log("Loaded HTML ",b);e()})};
ThreeBox.preload.image=function(b,d,e){THREE.ImageUtils.loadTexture(b,null,function(h){var g={};g[d]=h;console.log("Loaded texture ",b);e(g)})};ThreeBox.preload.audio=function(b,d,e){var h=new XMLHttpRequest;h.open("GET",b,!0);h.responseType="arraybuffer";h.onload=function(){var g={};g[d]=h.response;console.log("Loaded audio ",b);e(g)};h.send()};
